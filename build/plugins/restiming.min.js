!function(){function a(a){var b,c,d,e,f,g,h,i,j={};for(b in a){c=b;for(d=0;d<C.xssBreakWords.length;d++)c=c.replace(C.xssBreakWords[d],"$1"+H+"$2");if(a.hasOwnProperty(b)){e=a[b];f=c.split("");h=j;for(d=0;d<f.length;d++){g=f[d];i=h[g];void 0===i?h=h[g]=d===f.length-1?e:{}:"string"==typeof i?h=h[g]={"|":i}:d===f.length-1?h[g]["|"]=e:h=h[g]}}}return j}function b(a,c){var d,e,f,g=0,h=[];for(d in a)a.hasOwnProperty(d)&&h.push(d);for(var i=0;i<h.length;i++){d=h[i];if("object"==typeof a[d]){e=b(a[d],!1);if(e){delete a[d];if(d===H){d=e.name;g++}else d+=e.name;a[d]=e.value}}g++}if(1===g){if(c){f={};f[d]=a[d];return f}return{name:d,value:a[d]}}return!!c&&a}function c(a,b){"number"!=typeof a&&(a=0);"number"!=typeof b&&(b=0);var c=Math.round(a||0),d=Math.round(b||0);return 0===c?0:c-d}function d(a){try{a.location&&a.location.href;a.document;if("performance"in a&&a.performance)return!0}catch(b){}return!1}function e(a){var b=0;d(a)&&a.performance.timing&&a.performance.timing.navigationStart&&(b=a.performance.timing.navigationStart);return b}function f(a,b,c,h,j){function k(a){return C.serverTiming&&a.serverTiming||[]}var l,m,n,p,q,r,s,t,u,v,w,x=[],y={},z={};void 0===b&&(b=!0);void 0===c&&(c=0);void 0===h&&(h=0);if(h>10)return x;try{if(!d(a))return x;n=e(a);v=i(a,j);w=a.document.createElement("a");g(w,y,"script");g(w,z,"link");r=a.document.getElementsByTagName("iframe");if(r&&r.length)for(l=0;l<r.length;l++){p=e(r[l].contentWindow);q=0;p>n&&(q=c+(p-n));w.href=r[l].src;x=x.concat(f(r[l].contentWindow,!1,q,h+1,v[w.href]))}if("function"!=typeof a.performance.getEntriesByType)return x;if(b){m=a.performance.getEntriesByType("navigation");if(m&&1===m.length){s=m[0];x.push({name:a.location.href,startTime:0,initiatorType:"html",redirectStart:s.redirectStart,redirectEnd:s.redirectEnd,fetchStart:s.fetchStart,domainLookupStart:s.domainLookupStart,domainLookupEnd:s.domainLookupEnd,connectStart:s.connectStart,secureConnectionStart:s.secureConnectionStart,connectEnd:s.connectEnd,requestStart:s.requestStart,responseStart:s.responseStart,responseEnd:s.responseEnd,workerStart:s.workerStart,encodedBodySize:s.encodedBodySize,decodedBodySize:s.decodedBodySize,transferSize:s.transferSize,serverTiming:k(s)})}else if(a.performance.timing){t=a.performance.timing;0!==t.navigationStart&&t.responseEnd<=t.navigationStart+36e5&&x.push({name:a.location.href,startTime:0,initiatorType:"html",redirectStart:t.redirectStart?t.redirectStart-t.navigationStart:0,redirectEnd:t.redirectEnd?t.redirectEnd-t.navigationStart:0,fetchStart:t.fetchStart?t.fetchStart-t.navigationStart:0,domainLookupStart:t.domainLookupStart?t.domainLookupStart-t.navigationStart:0,domainLookupEnd:t.domainLookupEnd?t.domainLookupEnd-t.navigationStart:0,connectStart:t.connectStart?t.connectStart-t.navigationStart:0,secureConnectionStart:t.secureConnectionStart?t.secureConnectionStart-t.navigationStart:0,connectEnd:t.connectEnd?t.connectEnd-t.navigationStart:0,requestStart:t.requestStart?t.requestStart-t.navigationStart:0,responseStart:t.responseStart?t.responseStart-t.navigationStart:0,responseEnd:t.responseEnd?t.responseEnd-t.navigationStart:0})}}var A=a.performance.getEntriesByType("resource"),B=[];if(a===BOOMR.window&&C.collectedEntries){Array.prototype.push.apply(A,C.collectedEntries);C.collectedEntries=[]}for(l=0;A&&l<A.length;l++){t=A[l];u={name:t.name,initiatorType:t.initiatorType,encodedBodySize:t.encodedBodySize,decodedBodySize:t.decodedBodySize,transferSize:t.transferSize,serverTiming:k(t),visibleDimensions:v[t.name],latestTime:o(t)};for(var D=0;D<F.length;D++){var G=F[D];u[G]="startTime"===G||t[G]?t[G]+c:0}t.hasOwnProperty("_data")&&(u._data=t._data);if(("script"===t.initiatorType||"link"===t.initiatorType)&&y[t.name]){var H=y[t.name];u.scriptAttrs=(H.async?M:0)|(H.defer?N:0);for(;1===H.nodeType&&"BODY"!==H.nodeName;)H=H.parentNode;u.scriptAttrs|="BODY"===H.nodeName?O:0}"link"===t.initiatorType&&z[t.name]&&BOOMR.utils.arrayFind(z[t.name].rel.split(/[\u0009\u000A\u000C\u000D\u0020]+/),function(a){a=a.toLowerCase();if(E[a]){u.linkAttrs=E[a];return!0}});B.push(u)}x=x.concat(B)}catch(I){return x}return x}function g(a,b,c){Array.prototype.forEach.call(a.ownerDocument.getElementsByTagName(c),function(c){a.href=c.currentSrc||c.src||"function"==typeof c.getAttribute&&c.getAttribute("xlink:href")||c.href;a.href.match(/^https?:\/\//)&&(b[a.href]=c)})}function h(a){return"number"==typeof a&&0!==a?a.toString(36):"string"==typeof a?a:""}function i(a,b){var c,d,e=["img","iframe","image"],f={},g=a.document,h=g.createElement("A");b=b||[0,0,0,0];c=b[3]+(void 0!==a.pageXOffset)?a.pageXOffset:(g.documentElement||g.body.parentNode||g.body).scrollLeft;d=b[2]+(void 0!==a.pageYOffset)?a.pageYOffset:(g.documentElement||g.body.parentNode||g.body).scrollTop;e.forEach(function(a){var b,e,i,j,k=g.getElementsByTagName(a);for(e=0;e<k.length;e++){b=k[e];if(b){j=b.currentSrc||b.src||"function"==typeof b.getAttribute&&b.getAttribute("src")||b.getAttribute("xlink:href");h.href=j;j=h.href;if(j&&!f[j]){i=b.getBoundingClientRect();if((i.height||b.offsetHeight)&&(i.width||b.offsetWidth)){f[j]=[i.height||b.offsetHeight,i.width||b.offsetWidth,Math.round(i.top+d),Math.round(i.left+c)];if(!b.naturalHeight&&!b.naturalWidth)continue;var l,m,n;if(b.currentSrc&&(b.srcset||b.parentNode&&b.parentNode.nodeName&&"PICTURE"===b.parentNode.nodeName.toUpperCase())){l=b.isConnected?b.ownerDocument.createElement("IMG"):new BOOMR.window.Image;l.src=j}else l=b;m=l.naturalHeight||b.naturalHeight;n=l.naturalWidth||b.naturalWidth;!m&&!n||f[j][0]===m&&f[j][1]===n||f[j].push(m,n)}}}}});return f}function j(a,b,c){var d,g,h=f(BOOMR.window,!0,0,0),i=e(BOOMR.window),j={};if(!h||!h.length)return{entries:[]};h.sort(function(a,b){return a.startTime-b.startTime});var k=[];for(d=0;d<h.length;d++){g=h[d];if(0!==g.name.indexOf("about:")&&0!==g.name.indexOf("javascript:")&&0!==g.name.indexOf("res:")&&!(g.name.indexOf(BOOMR.url)>-1||g.name.indexOf(BOOMR.config_url)>-1||"function"==typeof BOOMR.getBeaconURL&&BOOMR.getBeaconURL()&&g.name.indexOf(BOOMR.getBeaconURL())>-1||a&&i+g.startTime<a)){if(b&&i+g.startTime>b)break;if(void 0===c||"*"===c||!c.length||g.initiatorType&&BOOMR.utils.inArray(g.initiatorType,c)){w(j,g.serverTiming);k.push(g)}}}var l=x(j);return{entries:k,serverTiming:{lookup:l,indexed:y(l)}}}function k(a){var b,c,d,e;if(a.encodedBodySize||a.decodedBodySize||a.transferSize){b=a.transferSize;c=a.encodedBodySize;d=a.decodedBodySize;e=[c,b?b-c:"_",d?d-c:0];return e.map(h).join(",").replace(/,+$/,"")}return""}function l(a,b){var c,d;void 0===b&&(b={});c=a.split(",");for(d=0;d<c.length;d++)if("_"===c[d])c[d]=0;else{""===c[d]&&(c[d]=0);c[d]=parseInt(c[d],36);d>0&&(c[d]+=c[0])}1===c.length&&c.push(c[0]);2===c.length&&c.push(c[0]);b.encodedBodySize=c[0];b.transferSize=c[1];b.decodedBodySize=c[2];return b}function m(a){var b,c,d,e={},f=[0,0,0];b=a.split("!");for(c=0;c<b.length;c++){d=b[c].replace(/^~/,"Infinity~").replace("-","~0~").split("~").map(function(a,b){a="Infinity"===a?1/0:parseInt(a,36);2===b?a=f[1]-a:a+=f[b];f[b]=a;return a});e[d[0]]=[d[1],d[2]||d[1]]}return e}function n(a,b){var c,d,e;if(a&&b)for(c=0;c<b.length;c++){e=b[c];if("string"==typeof e){d=a.indexOf(e);if(-1!==d){a=a.substr(0,d+e.length)+"...";break}}else e instanceof RegExp&&e.test(a)&&(a=a.replace(e,"$1")+"...")}return BOOMR.utils.cleanupURL(a,C.urlLimit)}function o(a){return a.responseEnd?a.responseEnd:a.responseStart&&a.startTime?a.responseStart+.2*(a.responseStart-a.startTime):1/0}function p(a,b,c){var d=BOOMR.window.screen,e=d.height,f=d.width;return b.reduce(function(a,b){var d,g,h,i,j,k;d=Math.max(0,b[3]);h=Math.max(0,b[2]);g=Math.min(b[3]+b[1],f);i=Math.min(b[2]+b[0],e);if(d>=g||h>=i)return a;for(k=h;k<i;k++){a[k]||(a[k]=[]);for(j=d;j<g;j++)a[k][j]=c}return a},a||[])}function q(a,b,c){b=b||0;c=c||1/0;return a.reduce(function(a,d){return a+d.filter(function(a){return b<=a&&a<=c}).length},0)}function r(a){var b,c,d,e,f,g,i,j,k,l,m={},n=[];c=Object.keys(a);for(b=0;b<c.length;b++){f=Math.round(Number(c[b]));void 0===m[f]&&(m[f]=[]);Array.prototype.push.apply(m[f],a[c[b]])}c=Object.keys(m).map(Number).sort(function(a,b){return a-b});if(0===c.length)return{};for(b=0;b<c.length;b++){f=c[b];d=p(d,m[f],f);i=q(d);c[b]=[f,i]}e=0;g=0;j=0;for(b=0;b<c.length;b++){f=c[b][0];i=c[b][1];k=q(d,0,f);if(i>g||k>j){l=(f===1/0?"":h(Math.round(f-e)))+"~"+h(i-g)+"~"+h(i-k);l=l.replace(/~~/,"-").replace(/~$/,"");n.push(l);e=f;g=i;j=k}}return n.join("!").replace(/!+$/,"")}function s(d,e){var f,g,i,l,m,o={},p={},q=j(d,e,C.trackedResourceTypes),r=q.entries,s=q.serverTiming;if(!r||!r.length)return{restiming:{},servertiming:[]};for(f=0;f<r.length;f++){g=r[f];i=D[g.initiatorType];void 0===i&&(i=0);m=i+[c(g.startTime,0),c(g.responseEnd,g.startTime),c(g.responseStart,g.startTime),c(g.requestStart,g.startTime),c(g.connectEnd,g.startTime),c(g.secureConnectionStart,g.startTime),c(g.connectStart,g.startTime),c(g.domainLookupEnd,g.startTime),c(g.domainLookupStart,g.startTime),c(g.redirectEnd,g.startTime),c(g.redirectStart,g.startTime)].map(h).join(",").replace(/,+$/,"");var t=k(g);""!==t&&(m+=I+K+t);g.hasOwnProperty("scriptAttrs")&&(m+=I+L+g.scriptAttrs);g.serverTiming&&g.serverTiming.length&&(m+=I+P+g.serverTiming.reduce(function(a,b,c){var d=String(void 0!==b.duration?b.duration:b.value);"0."===d.substring(0,2)&&(d=d.substring(1));var e=b.name||b.metric,f=z(s.indexed[e].index,s.indexed[e].descriptions[b.description]);a+=(c>0?",":"")+d+f;return a},""));g.hasOwnProperty("linkAttrs")&&(m+=I+Q+g.linkAttrs);l=n(g.name,C.trimUrls);if(g.hasOwnProperty("_data")){var u="";for(var v in g._data)g._data.hasOwnProperty(v)&&(u+=I+R+v+":"+g._data[v]);void 0===o[l]?o[l]=m+u:o[l]+=u}else void 0!==o[l]?o[l]+="|"+m:g.visibleDimensions?o[l]=I+J+g.visibleDimensions.map(Math.round).map(h).join(",").replace(/,+$/,"")+"|"+m:o[l]=m;if(g.visibleDimensions){p[g.latestTime]||(p[g.latestTime]=[]);p[g.latestTime].push(g.visibleDimensions)}}return{restiming:b(a(o),!0),servertiming:s.lookup}}function t(a){var b=[];if(!a||!a.length)return b;for(var c=0;c<a.length;c++){var d=a[c];c!==a.length-1&&d.fetchStart===a[c+1].fetchStart||b.push({fetchStart:d.fetchStart,responseEnd:d.responseStart||d.responseEnd})}return b}function u(a){var b;if(!a||!a.length)return 0;a.sort(function(a,b){return a.fetchStart!==b.fetchStart?a.fetchStart-b.fetchStart:(a.responseStart||a.responseEnd)-(b.responseStart||b.responseEnd)});var c=t(a),d=[],e=0;for(b=0;b<c.length;b++){var f=c[b];f.fetchStart<e&&(f.fetchStart=e);if(f.fetchStart<f.responseEnd){d.push(f);e=f.responseEnd}}var g=t(d),h=0;for(b=0;b<g.length;b++)h+=g[b].responseEnd-g[b].fetchStart;return h}function v(a,b){var c;if("undefined"!=typeof JSON){BOOMR.removeVar("restiming");BOOMR.removeVar("servertiming");c=s(a,b);if(c){BOOMR.info("Client supports Resource Timing API","restiming");A(c)}}}function w(a,b){(b||[]).forEach(function(b){var c=b.name||b.metric;void 0===a[c]&&(a[c]={count:0,counts:{}});var d=a[c];d.counts[b.description]=d.counts[b.description]||0;d.counts[b.description]++;d.count++})}function x(a){return Object.keys(a).sort(function(b,c){return a[c].count-a[b].count}).reduce(function(b,c){var d=Object.keys(a[c].counts).sort(function(b,d){return a[c].counts[d]-a[c].counts[b]});b.push(1===d.length&&""===d[0]?c:[c].concat(d));return b},[])}function y(a){return a.reduce(function(a,b,c){var d,e;if(Array.isArray(b)){d=b[0];e=b.slice(1).reduce(function(a,b,c){a[b]=c;return a},{})}else{d=b;e={"":0}}a[d]={index:c,descriptions:e};return a},{})}function z(a,b){var c="";a&&(c+=a);b&&(c+="."+b);c.length&&(c=":"+c);return c}function A(a){BOOMR.addVar("restiming",JSON.stringify(a.restiming));a.servertiming.length&&BOOMR.addVar("servertiming",BOOMR.utils.serializeForUrl(a.servertiming))}function B(a,b){var c=b.split(":"),d=Number(c[0]),e=0,f=0;if(c.length>1){var g=c[1].split(".");""!==g[0]&&(e=Number(g[0]));g.length>1&&(f=Number(g[1]))}var h,i="";if(Array.isArray(a[e])){h=a[e][0];i=a[e][1+f]||""}else h=a[e];return{name:h,duration:d,description:i}}var C;BOOMR=window.BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};if(!BOOMR.plugins.ResourceTiming){var D={other:0,img:1,link:2,script:3,css:4,xmlhttprequest:5,html:6,image:7,beacon:8,fetch:9,iframe:"a",subdocument:"a"},E={prefetch:1,preload:2,prerender:3,stylesheet:4},F=["startTime","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","secureConnectionStart","connectEnd","requestStart","responseStart","responseEnd","workerStart"],G=[/(h)(ref)/gi,/(s)(rc)/gi,/(a)(ction)/gi],H="\n",I="*",J="0",K="1",L="2",M=1,N=2,O=4,P="3",Q="4",R="5";C={complete:!1,sentNavBeacon:!1,initialized:!1,supported:null,xhr_load:function(){if(!this.complete){this.complete=!0;BOOMR.sendBeacon()}},xssBreakWords:G,urlLimit:500,clearOnBeacon:!1,trimUrls:[],serverTiming:!0,monitorClearResourceTimings:!1,trackedResourceTypes:"*",done:function(){if(!this.sentNavBeacon){v();this.complete=!0;this.sentNavBeacon=!0;BOOMR.sendBeacon()}},onBeacon:function(a){var b=BOOMR.getPerformance();a.hasOwnProperty("restiming")&&BOOMR.removeVar("restiming");a.hasOwnProperty("servertiming")&&BOOMR.removeVar("servertiming");if(C.clearOnBeacon&&b){var c=b.clearResourceTimings||b.webkitClearResourceTimings;c&&"function"==typeof c&&c.call(b)}},prerenderToVisible:function(){this.sentNavBeacon=!1;this.done()}};BOOMR.plugins.ResourceTiming={init:function(a){BOOMR.utils.pluginConfig(C,a,"ResourceTiming",["xssBreakWords","clearOnBeacon","urlLimit","trimUrls","trackedResourceTypes","serverTiming","monitorClearResourceTimings"]);if(C.initialized)return this;if(this.is_supported()){BOOMR.subscribe("page_ready",C.done,null,C);BOOMR.subscribe("prerender_to_visible",C.prerenderToVisible,null,C);BOOMR.subscribe("xhr_load",C.xhr_load,null,C);BOOMR.subscribe("beacon",C.onBeacon,null,C);BOOMR.subscribe("before_unload",C.done,null,C);if(C.monitorClearResourceTimings){var b=this;BOOMR.window.performance.clearResourceTimings=function(a){return function(){b.addResources(BOOMR.window.performance.getEntriesByType("resource"));a.apply(BOOMR.window.performance,arguments)}}(BOOMR.window.performance.clearResourceTimings)}}else C.complete=!0;C.initialized=!0;return this},is_complete:function(){return!0},is_enabled:function(){return C.initialized&&this.is_supported()},is_supported:function(){var a;if(null!==C.supported)return C.supported;var a=BOOMR.getPerformance();C.supported=a&&"function"==typeof a.getEntriesByType&&void 0!==window.PerformanceResourceTiming;return C.supported},addResources:function(a,b){if(this.is_supported()&&BOOMR.utils.isArray(a)){C.collectedEntries=C.collectedEntries||[];if("number"==typeof b){var c=BOOMR.window.performance.timeOrigin||BOOMR.window.performance.timing.navigationStart,d=b-c;a=BOOMR.utils.arrayFilter(a,function(a){for(var b=0;b<F.length;b++){var c=F[b];a.hasOwnProperty(c)&&(a[c]+=d)}return!0})}Array.prototype.push.apply(C.collectedEntries,a)}},getCompressedResourceTiming:s,getFilteredResourceTiming:j,calculateResourceTimingUnion:u,addResourceTimingToBeacon:v,addToBeacon:A,trimTiming:c,convertToTrie:a,optimizeTrie:b,findPerformanceEntriesForFrame:f,toBase36:h,getVisibleEntries:i,reduceFetchStarts:t,compressSize:k,decompressSize:l,trimUrl:n,getResourceLatestTime:o,mergePixels:p,countPixels:q,getOptimizedTimepoints:r,decompressTimePoints:m,accumulateServerTimingEntries:w,compressServerTiming:x,indexServerTiming:y,identifyServerTimingEntry:z,decompressServerTiming:B,SPECIAL_DATA_PREFIX:I,SPECIAL_DATA_DIMENSION_TYPE:J,SPECIAL_DATA_SIZE_TYPE:K,SPECIAL_DATA_SCRIPT_ATTR_TYPE:L,SPECIAL_DATA_LINK_ATTR_TYPE:Q,ASYNC_ATTR:M,DEFER_ATTR:N,LOCAT_ATTR:O,INITIATOR_TYPES:D,REL_TYPES:E}}}();
//# sourceMappingURL=restiming.min.js.map